
# for now, create a type manually. TODO: use type constructor.
<let Test (CONS Type
  `Test
  (CONS Type-kind-struct
    (CONS Arr-Par)
    nil))> # dispatcher starts as nil.

<let-fn dispatcher [-callee:Test -types:Arr-Types]
  # NOTE: specifying correct type T for callee would create a cycle.
  <check (ieq (alen types) 1) "dispatcher requires 1 argument">
  <let T0 (ael types 0)>
  <if
    (is T0 Sym)   <fn [-obj:Sym]  (outRSL `Sym obj)>
    (is T0 Int)   <fn [-obj:Int]  (outRSL `Int obj)>
    (is T0 Data)  <fn [-obj:Data] (outRSL `Data obj)>
    (error "dispatcher cannot handle argument type (intentional test error)")>>

(.=dispatcher (.kind Test) dispatcher) # set the dispatcher, creating a cycle.
(globalize Test)

<let i (CONS Test)>
(i `s)
(i 1)
(i "hi")
